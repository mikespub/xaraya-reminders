<?xml version="1.0" encoding="utf-8"?>
<xar:template xmlns:xar="http://xaraya.com/2004/blocklayout">
    <xar:template file="admin-mod-head"/>
    <div class="xar-mod-body">
        <h2>Test Reminders</h2>
    </div>

	<xar:if condition="$confirm">
		<xar:if condition="empty($result)">
			<p class="alert alert-warning" style="text-align: left; padding:20px;">
				No emails were chosen
			</p>
		<xar:elseif condition="isset($result['exception'])/">
			<xar:set name="isdebug">
				xarModVars::get('reminders','debugmode')
			</xar:set>
			<xar:set name="isadmin">
				in_array(xarUser::getVar('id'),xarConfigVars::get(null, 'Site.User.DebugAdmins'))
			</xar:set>
			<xar:if condition="$isdebug AND $isadmin">
				<p class="alert alert-danger" style="text-align: left; padding:20px;">
					#$result['exception']#
				</p>
			<xar:else/>
				<p class="alert alert-danger" style="text-align: left; padding:20px;">
					The email failed. Please contact the site administrator
				</p>
			</xar:if>
		<xar:elseif condition="$result['code'] eq 0"/>
			<p class="alert alert-success" style="text-align: left; padding:20px;">
				<xar:if condition="$test">
					A test email was sent successfully to<br/>
					#$result['test_name']# (#$result['test_email']#)<br/>
					<xar:if condition="!empty($result['email'])">
						The actual recipient would be:<br/>
						#$result['name']# (#$result['email']#)
					<xar:else/>
						No actual recipient was chosen
					</xar:if>
				<xar:else/>
					A course email was sent successfully to<br/>
					#$result['name']# (#$result['email']#)
				</xar:if>
			</p>
		<xar:elseif condition="$result['code'] eq -1"/>
			<p class="alert-success" style="text-align: left; padding:20px;">
				Thank you for your submission
			</p>
		<xar:else />
			<p class="alert alert-danger" style="text-align: left; padding:20px;">
				The email failed. The result code was 
				#$result['code']#
			</p>
		</xar:if>
	</xar:if>

    <xar:data-input type="listing" object="$object" tplmodule="reminders"/>
    <form method="post" action="#xarServer::getCurrentURL()#">
        <div class="xar-row">
            <div class="xar-col">
            </div>
            <div class="xar-col">
                <input type="hidden" name="authid" id="authid" value="#xarSecGenAuthKey()#"/>
                <input type="hidden" name="name" id="name" value="#$object:name#"/>
                <input type="hidden" name="confirm" id="confirm" value="true"/>
                <xar:var name="label">Cancel</xar:var>
                <xar:button type="cancel" name="cancel" value="$label"/>
                <xar:var name="label">Test</xar:var>
                <xar:button type="submit" name="post" value="$label" class="btn-primary"/>
            </div>
        </div>
    </form>
</xar:template>